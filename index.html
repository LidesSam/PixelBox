<!DOCTYPE html>
<html></html>
<head>
    <title>
        pixelbox 
    </title>
    <link rel="stylesheet" type="text/css" href="css/pixelboxStyle.css"/>
</head>

<body>
    <div>
        version Monocrome 0.1
    </div> 
    
    <main>
        <pixelbox>
            <nav>
                
                <button onclick=ClearCanvas()>
                    new
                </button>
                
                <button onclick=saveAsImage()>
                    save
                </button>
               
                
                
                <h3> size: <span id="sizePx">"16x16"</span> <h3>
                <input type="text" name="" id="">16</input>
            </nav>
            <nav id="toolbox">
                <button onclick=setToolPen()>
                    pen
                </button>
                
                <button onclick=setToolEraser()>
                    eraser
                </button>
                Current Tool: <span id="currentTool">"pen"</span>

            </nav>
            <canvas id="myCanvas" width="400px" height="400px" bac>

            </canvas>
            <div>
                mx:<span id="mousex">0</span> /16  my: <span id="mousey">0</span>/16
            </div>
        </pixelbox>
    </main>
</body>

<script>
var defSize = 16
var canvas = document.getElementById("myCanvas");
var canvasContext = canvas.getContext("2d");
var blockSize = canvas.width/16
//defaut tool pen draw a pixel 
var  mousedIsDown=false
var tool="pen"
var drawMatrix = [];
for(var i=0; i<16;i++){
    var line = [];
    for(var j=0; j<16;j++){
        line.push(0);
    }
    drawMatrix.push(line)
}
canvasContext.fillStyle = "black";//procitional ultil more tool are avaible(it gonna become obsolete)

//alert(blockSize)
ClearCanvas()
//DrawPixel(2,0,blockSize)



function ClearCanvas(){
   
    canvasContext.fillStyle = "white";
    canvasContext.fillRect(0, 0, canvas.width, canvas.height);
    
    setToolPen()
}


function DrawPixel(posx, posy,bsize){
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
   // canvasContext.fillStyle = "black";
    
    var px = posx*bsize
    var py = posy*bsize
    
    ctx.fillRect(px,py,bsize,bsize);
    
}


function setToolPen(){
    //provitional
    tool="pen"
    canvasContext.fillStyle = "black";
    setToolText()
}

function setToolEraser(){
    tool="eraser"
    //provitional // only until new tools being added
    canvasContext.fillStyle = "white";
    setToolText()
}

function setToolText(){
    var label = document.getElementById("currentTool");
    label.textContent=tool;
}

var container = document.getElementsByClassName('container')[0];
document.addEventListener('click', function( event ) {
  DrawPixelInMosusePos(event)
});

function DrawPixelInMosusePos(event){

    if (canvas == event.target && canvas.contains(event.target)) {    
    
    //calculatemouse position on 
    var mPos= getMousePos(canvas,event)
    
     var tpx=Math.round(mPos.x/blockSize/2)
     var tpy=Math.round(mPos.y/blockSize/2)
    updateMousePos(mPos)
     
     DrawPixel(tpx,tpy,blockSize)
    }}

addEventListener("mousedown", function(event ){
    mousedIsDown=true
});

addEventListener("mouseup", function(event ){
    mousedIsDown=false
});

addEventListener("mousemove",function(event){
    if(mousedIsDown){
        DrawPixelInMosusePos(event)
    }else{
        var mPos= getMousePos(canvas,event)
        updateMousePos(mPos)
    }

    
})
function updateMousePos(mPos){
    var tpx=Math.round(mPos.x/blockSize/2)+1
    var tpy=Math.round(mPos.y/blockSize/2)+1
    
    

    if(tpx<=0 ||tpy<=0 ||tpx>=16 ||tpy>=16 )
    {
        document.getElementById("mousex").textContent="--"
        document.getElementById("mousey").textContent="--"
    }else{
        document.getElementById("mousex").textContent=tpx.toString()
    
    document.getElementById("mousey").textContent=tpy.toString() 
    }
  
}
function getMousePos(_canvas, evt) {
    var rect = _canvas.getBoundingClientRect();
    //console.log(rect)

    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
}

function GridFixer(){

}


function saveAsImage(){
 
  let image = canvas.toDataURL("image/png", 1.0).replace("image/png", "image/octet-stream");
  let link = document.createElement('a');
  link.download = "my-image.png";
  link.href = image;
  link.click();
}
</script>

</html>

